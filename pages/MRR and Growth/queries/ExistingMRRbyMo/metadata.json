{
  "gitSyncId": "63e8d02d1e242279f5911ffe_63ecc0578e503f76365181a9",
  "id": "MRR and Growth_ExistingMRRbyMo",
  "pluginId": "mysql-plugin",
  "pluginType": "DB",
  "unpublishedAction": {
    "actionConfiguration": {
      "body": "SELECT\n  DATE_FORMAT(first_day, '%Y-%m') AS month,\n  COUNT(DISTINCT subscriptions.id) AS subscriptions,\n  ROUND(SUM(\n    CASE\n      WHEN subscriptions.created >= DATE_SUB(subscriptions.created, INTERVAL 12 MONTH)\n      THEN subscriptions.initial_amount / 12\n      ELSE subscriptions.recurring_amount / 12\n    END\n  ), 2) AS mrr\nFROM (\n  SELECT DISTINCT\n    s.id,\n    s.created,\n    s.expiration,\n    s.initial_amount,\n    s.recurring_amount,\n    s.parent_payment_id\n  FROM wp_edd_subscriptions s\n  LEFT JOIN (\n    SELECT parent AS parent_payment_id\n    FROM wp_edd_orders\n    WHERE status = 'refunded'\n    AND parent IS NOT NULL\n\n    UNION\n\n    SELECT id AS parent_payment_id\n    FROM wp_edd_orders\n    WHERE status = 'refunded'\n  ) AS refunded\n    ON refunded.parent_payment_id = s.parent_payment_id\n  WHERE refunded.parent_payment_id IS NULL\n) AS subscriptions\nJOIN (\n  SELECT DATE_FORMAT(DATE_SUB(NOW(), INTERVAL seq MONTH), '%Y-%m-01') AS first_day\n  FROM (\n    SELECT 0 AS seq UNION ALL SELECT 1 UNION ALL SELECT 2 UNION ALL SELECT 3\n    UNION ALL SELECT 4 UNION ALL SELECT 5 UNION ALL SELECT 6 UNION ALL SELECT 7\n    UNION ALL SELECT 8 UNION ALL SELECT 9 UNION ALL SELECT 10 UNION ALL SELECT 11\n    UNION ALL SELECT 12 UNION ALL SELECT 13 UNION ALL SELECT 14 UNION ALL SELECT 15\n    UNION ALL SELECT 16 UNION ALL SELECT 17 UNION ALL SELECT 18 UNION ALL SELECT 19\n    UNION ALL SELECT 20 UNION ALL SELECT 21 UNION ALL SELECT 22 UNION ALL SELECT 23\n  ) AS seqs\n) AS months\n  ON subscriptions.created < months.first_day\n  AND subscriptions.expiration >= months.first_day\nGROUP BY month\nORDER BY month ASC;",
      "encodeParamsToggle": true,
      "paginationType": "NONE",
      "pluginSpecifiedTemplates": [
        {
          "value": false
        }
      ],
      "timeoutInMillisecond": 20000
    },
    "confirmBeforeExecute": false,
    "datasource": {
      "id": "Easy Digital Downloads",
      "isAutoGenerated": false,
      "name": "Easy Digital Downloads",
      "pluginId": "mysql-plugin"
    },
    "dynamicBindingPathList": [],
    "name": "ExistingMRRbyMo",
    "pageId": "MRR and Growth",
    "runBehaviour": "ON_PAGE_LOAD",
    "userSetOnLoad": false
  }
}